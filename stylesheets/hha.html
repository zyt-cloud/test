<script type="text/javascript">publicSettings.controllerName="Goods",publicSettings.actionName="editAccessories",publicSettings.self="/ndhb/www/index.php?s=/Manager/Goods/editAccessories/goods_id/82.shtml&_dialog_=1&_=1442540580048";var _Goods_editAccessories_=false;</script><div class="modal fade" id="xzsp1" tabindex="3" role="dialog" aria-labelledby="myModalLabel"
aria-hidden="true">
	<div class="modal-dialog large-width ">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h4 class="modal-title" id="myModalLabel">
					新增商品
				</h4>
			</div>
			<div class="modal-body">
				<div class="panel panel-default panel-default1 tab-pane" id="sz">
					<form action="/ndhb/www/index.php?s=/Manager/Goods/updateAccessories.shtml" id="fm-add-accessories">
						<input name="is_edit" type="hidden" value="1" />
						<div class="form-group m-b m-t">
							<div class="col-xs-12 ">
								<div class="row">
									<label class="col-xs-2 control-label ">
										主商品：
									</label>
									<div class="col-xs-10">
										<div class="input-group1">
											<input type="text" name="goods_name" id="acc_base_goods_name" value="紫米山药"
											class="form-control input-sm" placeholder="请选择商品" />
											<input name="goods_id" type="hidden" id="acc_base_goods_id" value="82"
											/>
											<div class="btn-group dropleft jxssz input-group-btn dropdown">
												<button type="button" class="btn btn-sm btn-default btn-addon dropdown-toggle input-sm"
												data-toggle="dropdown">
													选择商品
												</button>
												<div class="dropdown-menu fadeInUp" style="left:-430px" id="div-base-goods">
													<div class="panel bg-white">
														<div class="panel-heading b-light bg-light">
															<strong>
																选择商品
															</strong>
														</div>
														<div>
															<div class="row wrapper1">
																<div class="col-xs-12 m-b-xs">
																	<select name="category" class="select2 input-sm form-control inline v-middle w-sm">
																		<option value="">
																			全部
																		</option>
																		<option value='41'  > 饼干点心</option><option value='51'  >&nbsp; ├ 派蛋糕</option><option value='50'  >&nbsp; ├ 曲奇饼干</option><option value='52'  >&nbsp; └ 夹心饼干</option><option value='40'  > 早餐食品</option><option value='49'  >&nbsp; └ 冲调用粉</option><option value='55'  >&nbsp;&nbsp; └ 测试</option><option value='42'  > 膨化食品</option><option value='53'  >&nbsp; └ 海苔</option><option value='43'  > 核果蜜饯</option><option value='54'  >&nbsp; └ 蜜饯</option><option value='44'  > 糖果巧克力</option><option value='45'  > 方便食品</option><option value='46'  > 进口食品</option><option value='48'  > 麦片粥粉</option>																	</select>
																	<select name="brand" class="select2 input-sm form-control inline v-middle w-sm">
																		<option value="">
																			全部
																		</option>
																		<option value="26">
																			德芙																		</option><option value="25">
																			佳日																		</option><option value="23">
																			海澜之家																		</option><option value="21">
																			茅台																		</option><option value="20">
																			56																		</option><option value="18">
																			水电费凤飞飞																		</option><option value="17">
																			睡的地方上																		</option><option value="16">
																			山大																		</option>																	</select>
																	<input name="kw" class="input-sm form-control inline v-middle w-sm" placeholder="搜索条件"
																	type="text">
																	<button type="button" class="btn btn-sm btn-default" id="btn-search-base-com">
																		<i class="fa fa-search">
																		</i>
																		搜索
																	</button>
																</div>
															</div>
															<div id="view-accessories-add-base-goods">
																<table class="table m-b-none row1">
																	<thead>
																		<tr>
																			<th style="width:20px;">
																				<label class="i-checks m-b-none">
																					<input type="checkbox" />
																					<i>
																					</i>
																				</label>
																			</th>
																			<th>
																				商品编号
																			</th>
																			<th>
																				商品名称
																			</th>
																		</tr>
																	</thead>
																	<tbody>
																		<tr>
																			<td colspan="3" align="center">
																				数据加载中...
																			</td>
																		</tr>
																	</tbody>
																</table>
																<div style="clear:both">
																</div>
																<footer class="panel-footer text-left lter ">
																	<button class="btn m-b-xs w-xs btn-info">
																		确定
																	</button>
																</footer>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class=" col-xs-12 m-t ">
								<div class="row">
									<label class="col-xs-2 control-label ">
										推荐商品：
									</label>
									<div class="col-xs-10">
										<div class="btn-group dropleft jxssz input-group-btn dropdown">
											<button type="button" class="btn btn-sm btn-default btn-addon input-sm dropdown-toggle"
											data-toggle="dropdown">
												<i class="fa fa-plus">
												</i>
												选择商品
											</button>
											<div class="dropdown-menu fadeInUp" style="left:0px" id="div-son-goods">
												<div class="panel bg-white  ">
													<div class="panel-heading b-light bg-light">
														<strong>
															选择商品
														</strong>
													</div>
													<div>
														<div class="row wrapper1 ">
															<div class="col-xs-12 m-b-xs">
																<select name="category" class="select2 input-sm form-control inline v-middle w-sm">
																	<option value="">
																		全部
																	</option>
																	<option value='41'  > 饼干点心</option><option value='51'  >&nbsp; ├ 派蛋糕</option><option value='50'  >&nbsp; ├ 曲奇饼干</option><option value='52'  >&nbsp; └ 夹心饼干</option><option value='40'  > 早餐食品</option><option value='49'  >&nbsp; └ 冲调用粉</option><option value='55'  >&nbsp;&nbsp; └ 测试</option><option value='42'  > 膨化食品</option><option value='53'  >&nbsp; └ 海苔</option><option value='43'  > 核果蜜饯</option><option value='54'  >&nbsp; └ 蜜饯</option><option value='44'  > 糖果巧克力</option><option value='45'  > 方便食品</option><option value='46'  > 进口食品</option><option value='48'  > 麦片粥粉</option>																</select>
																<select name="brand" class="select2 input-sm form-control inline v-middle w-sm">
																	<option value="">
																		全部
																	</option>
																	<option value="26">
																		德芙																	</option><option value="25">
																		佳日																	</option><option value="23">
																		海澜之家																	</option><option value="21">
																		茅台																	</option><option value="20">
																		56																	</option><option value="18">
																		水电费凤飞飞																	</option><option value="17">
																		睡的地方上																	</option><option value="16">
																		山大																	</option>																</select>
																<input name="kw" class="input-sm form-control inline v-middle w-sm" placeholder="搜索条件"
																type="text">
																<button type="button" class="btn btn-sm btn-info" id="btn-search-son-acc">
																	<i class="fa fa-search">
																	</i>
																	搜索
																</button>
															</div>
														</div>
														<div id="view-accessories-add-son-goods">
															<table class="table m-b-none row1 small-width">
																<thead>
																	<tr>
																		<th style="width:20px;">
																			<label class="i-checks m-b-none">
																				<input type="checkbox" />
																				<i>
																				</i>
																			</label>
																		</th>
																		<th>
																			商品编号
																		</th>
																		<th>
																			商品名称
																		</th>
																	</tr>
																</thead>
																<tbody>
																	<tr>
																		<td colspan="3" align="center">
																			数据加载中...
																		</td>
																	</tr>
																</tbody>
															</table>
															<div style="clear:both">
															</div>
															<footer class="panel-footer text-left lter ">
																<button class="btn m-b-xs w-xs btn-info">
																	确定
																</button>
																<ul id="ChangeAgency-Pagination" class="pagination pagination-sm pull-right">
																</ul>
																<div style="clear:both;">
																</div>
															</footer>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-xs-offset-2 col-xs-10">
								<table class="table m-b-none panel panel-default m-t" id="table-add-content-accessories"
																	>
									<thead>
										<tr>
											<th width="60">
												序号
											</th>
											<th>
												商品名称
											</th>
											<th width="70">
												单位
											</th>
											<th width="60">
												管理
											</th>
										</tr>
									</thead>
									<tbody>
										<tr class="clone" style="display:none;">
											<td>
												
											</td>
											<td>
												
											</td>
											<td>
												
											</td>
											<td>
												<input name="accessories_goods_id[]" type="hidden" />
												<a class="btn btn-link btn_1 btn-default btn-default btn-del-accessories-goods">
													<span class="fa fa-times">
													</span>
												</a>
											</td>
										</tr>
										<tr>
											<td>
												1											</td>
											<td>
												商品0001											</td>
											<td>
												个											</td>
											<td>
												<input name="accessories_goods_id[]" value="40" type="hidden"
												/>
												<a class="btn btn-link btn_1 btn-default btn-default btn-del-accessories-goods"
												data-goods_id="40">
													<span class="fa fa-times">
													</span>
												</a>
											</td>
										</tr><tr>
											<td>
												2											</td>
											<td>
												茅台											</td>
											<td>
												个											</td>
											<td>
												<input name="accessories_goods_id[]" value="57" type="hidden"
												/>
												<a class="btn btn-link btn_1 btn-default btn-default btn-del-accessories-goods"
												data-goods_id="57">
													<span class="fa fa-times">
													</span>
												</a>
											</td>
										</tr><tr>
											<td>
												3											</td>
											<td>
												宝洁-RS											</td>
											<td>
												条											</td>
											<td>
												<input name="accessories_goods_id[]" value="84" type="hidden"
												/>
												<a class="btn btn-link btn_1 btn-default btn-default btn-del-accessories-goods"
												data-goods_id="84">
													<span class="fa fa-times">
													</span>
												</a>
											</td>
										</tr><tr>
											<td>
												4											</td>
											<td>
												天地人											</td>
											<td>
												条											</td>
											<td>
												<input name="accessories_goods_id[]" value="105" type="hidden"
												/>
												<a class="btn btn-link btn_1 btn-default btn-default btn-del-accessories-goods"
												data-goods_id="105">
													<span class="fa fa-times">
													</span>
												</a>
											</td>
										</tr>									</tbody>
								</table>
							</div>
							<div style="clear:both">
							</div>
						</div>
					</form>
				</div>
				<!-- /.modal-content -->
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
				<button type="button" class="btn btn-info w-xs" data-loading-text="提交中..."
				id="btn-save-accessories">
					确定
				</button>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
window.accessories = JSON.parse("["40","57","84","105"]") || [];


function resetIndex(){
	$("#table-add-content-accessories tbody tr", _).each(function(i){
		$(this).find("td:eq(0)").html(i);
	});
}
$(function(){

	$("#view-accessories-add-base-goods", _).load("/ndhb/www/index.php?s=/Manager/Goods/changeGoodsAccessories.shtml&pageSize=" + publicSettings.minPageSize);
	$("#view-accessories-add-son-goods", _).load("/ndhb/www/index.php?s=/Manager/Goods/changeGoodsAccessories/type/son.shtml&pageSize=" + publicSettings.minPageSize,function(){
		$("#table-change-son-acc tbody input:checkbox", _).each(function(){
			var idx = $.inArray(parseInt($(this).val()),window.accessories);
			if(idx != -1){
				this.checked = 'checked';
			}
		});
	});

	
	$("#btn-search-base-com",_).unbind("click").click(function(){
		var $btn = $(this);
		var category = $btn.siblings("select[name='category']").val();
		var brand = $btn.siblings("select[name='brand']").val();
		var kw = $btn.siblings("input[name='kw']").val();
		var url = "/ndhb/www/index.php?s=/Manager/Goods/changeGoodsCombination.shtml" + '&pageSize=' + publicSettings.minPageSize + '&category_id=' + category + '&brand_id=' + brand + '&kw=' + encodeURI(kw);
		$("#view-accessories-add-base-goods", _).load(url);
	});

	
	$("#btn-search-son-acc",_).unbind("click").click(function(){
		var $btn = $(this);
		var category = $btn.siblings("select[name='category']").val();
		var brand = $btn.siblings("select[name='brand']").val();
		var kw = $btn.siblings("input[name='kw']").val();
		var url = "/ndhb/www/index.php?s=/Manager/Goods/changeGoodsCombination.shtml" + '&pageSize=' + publicSettings.minPageSize + '&type=son' + '&category_id=' + category + '&brand_id=' + brand + '&kw=' + encodeURI(kw);
		$("#view-accessories-add-son-goods", _).load(url);
	});

	
	$(".btn-del-accessories-goods", _).unbind('click').click(function(){
		var goodsId = $(this).prev("input[name='accessories_goods_id[]']").val();
		$(this).parent().parent().remove();
		resetIndex();
		delete window.accessories[$.inArray(parseInt(goodsId),window.accessories)];
		if($("#table-add-content-accessories tbody tr", _).length <= 1){
			$("#table-add-content-accessories", _).hide();
		}
	});

	
	$("#btn-save-accessories", _).unbind("click").click(function(){
		var $fm = $("#fm-add-accessories", _);
		//验证组合商品是否包含组合项及组合项是否为当前组合商品
		var goodsId = $fm.find("input[name='goods_id']").val();
		if(-1 != $.inArray(parseInt(goodsId),window.accessories)){
			$.DHB.message({content:"给合推荐商品不能推荐自已!"});
			return false;
		}

		if(window.accessories.length == 0){
			$.DHB.message({content:"请选择推荐的组合商品!"});
			return false;
		}

		$.post($fm.attr('action'),$fm.serialize(),function(json){
			$.DHB.message({content:json.message});
			if(json.status == 'success'){
				$.fn.menuTab.load_({
					url:"/ndhb/www/index.php?s=/Manager/Goods/accessories.shtml",
					nocache:1
				});
			}
		},'json');
	});

	$("#div-base-goods,#div-son-goods", _).unbind('click').click(function(e){
		e.stopPropagation();
	});

});
</script><script type="text/javascript">console.log("模板文件：{NDHB}/Dinghuobao/Manager/View/default/Goods/dialog/addAccessories.html");</script>